# Admin Web (static build + preview)
FROM node:22-alpine AS build
WORKDIR /app
COPY pnpm-workspace.yaml package.json tsconfig.json ./
COPY apps/admin-web ./apps/admin-web
COPY types ./types
COPY nginx/api-proxy.conf /etc/nginx/conf.d/default.conf
RUN corepack enable && corepack prepare pnpm@9.9.0 --activate \
 && pnpm -F admin-web i \
 && pnpm -F admin-web build
# Use vite preview (simple)
FROM nginx:alpine
# Copy built static files into nginx html directory
COPY --from=build /app/apps/admin-web/dist /usr/share/nginx/html
# copy nginx config from build stage into final image
COPY --from=build /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf
COPY --from=build /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/api-proxy.conf
EXPOSE 3000
# Run nginx in foreground (default)
