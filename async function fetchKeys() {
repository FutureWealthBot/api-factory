async function fetchKeys() {
  setLoading(true);
  const { data, error } = await sb.from("api_keys").select("*").order("created_at", { ascending: false });
  if (error) {
    alert("Failed to fetch API keys: " + error.message);
    setApiKeys([]);
  } else {
    setApiKeys(data ?? []);
  }
  setLoading(false);
}

async function createKey() {
  setLoading(true);
  const { data, error } = await sb.from("api_keys").insert({}).select().single();
  if (error) {
    alert("Failed to create API key: " + error.message);
    setNewKey(null);
  } else {
    setNewKey(data?.key ?? null);
    fetchKeys();
  }
  setLoading(false);
}

async function revokeKey(id: string) {
  setLoading(true);
  const { error } = await sb.from("api_keys").delete().eq("id", id);
  if (error) {
    alert("Failed to revoke API key: " + error.message);
  }
  fetchKeys();
  setLoading(false);
}